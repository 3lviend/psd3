var psd3=psd3||{};psd3.Graph=function(t){var i=this;this.config=t,this.defaults={width:400,height:400,value:"value",inner:"inner",label:function(t){return t.data.value},tooltip:function(t){return void 0!==i.config.value?t[i.config.value]:t.value},transition:"linear",transitionDuration:1e3,donutRadius:0};for(var n in this.defaults)this.defaults.hasOwnProperty(n)&&(t.hasOwnProperty(n)||(t[n]=this.defaults[n]))};
var psd3=psd3||{};psd3.Pie=function(t){psd3.Graph.call(this,t),this.zoomStack=[];var i="top";void 0!==this.config.heading&&void 0!==this.config.heading.pos&&(i=this.config.heading.pos),"top"==i&&this.setHeading(),this.drawPie(t.data),"bottom"==i&&this.setHeading()},psd3.Pie.prototype=Object.create(psd3.Graph.prototype),psd3.Pie.prototype.constructor=psd3.Pie,psd3.Pie.prototype.findMaxDepth=function(t){if(null===t||void 0===t||t.length<1)return 0;for(var i,e=0,n=0;n<t.length;n++){var o=this.findMaxDepth(t[n][this.config.inner]);o>e&&(e=o)}return i=1+e},psd3.Pie.prototype.setHeading=function(){void 0!==this.config.heading&&d3.select("#"+this.config.containerId).append("div").style("text-align","center").style("width",""+this.config.width+"px").style("padding-top","20px").style("padding-bottom","20px").append("strong").text(this.config.heading.text)},psd3.Pie.prototype.mouseover=function(t){d3.select("#"+_this.tooltipId).style("left",d3.event.clientX+"px").style("top",d3.event.clientY+"px").select("#value").html(_this.config.tooltip(t.data,_this.config.label)),d3.select("#"+_this.tooltipId).classed("psd3Hidden",!1)},psd3.Pie.prototype.mouseout=function(){d3.select("#"+_this.tooltipId).classed("psd3Hidden",!0)},psd3.Pie.prototype.drawPie=function(t){if(!(null===t||void 0===t||t.length<1)){_this=this,_this.arcIndex=0;var i=d3.select("#"+_this.config.containerId).append("svg").attr("id",_this.config.containerId+"_svg").attr("width",_this.config.width).attr("height",_this.config.height);_this.tooltipId=_this.config.containerId+"_tooltip";var e=d3.select("#"+_this.config.containerId).append("div").attr("id",_this.tooltipId).attr("class","psd3Hidden psd3Tooltip");e.append("p").append("span").attr("id","value").text("100%");var n;n=_this.config.width>_this.config.height?_this.config.width/2:_this.config.height/2;var o=_this.config.donutRadius,s=_this.findMaxDepth(t),a=o+(n-o)/s,r=d3.scale.category20(),d=a-o;_this.draw(i,r,0,n,t,t,t.length,o,a,d,0,7920/7/180,[0,0])}},psd3.Pie.prototype.customArcTween=function(t){var i={startAngle:t.startAngle,endAngle:t.startAngle},e=d3.interpolate(i,t);return function(i){return t.arc(e(i))}},psd3.Pie.prototype.textTransform=function(t){return"translate("+t.arc.centroid(t)+")"},psd3.Pie.prototype.textTitle=function(t){return t.data[_this.config.value]},psd3.Pie.prototype.draw=function(t,i,e,n,o,s,a,r,d,c,h,p,l){if(_this=this,!(null===o||void 0===o||o.length<1)){psd3.Pie.prototype.textText=function(t){return _this.config.label(t)};var g=d3.layout.pie();g.sort(null),g.value(function(t){return t[_this.config.value]}),g.startAngle(h).endAngle(p);for(var f=[],u=0;u<o.length;u++)f.push(o[u][_this.config.value]);var _=function(t){_this.reDrawPie(t,s)},v=d3.svg.arc().innerRadius(r).outerRadius(d);_this.arcIndex=_this.arcIndex+1;var x="arc"+_this.arcIndex,y=function(t){t.arc=v,t.length=o.length},P=t.selectAll("g."+x).data(g(o)).enter().append("g").attr("class","arc "+x).attr("transform","translate("+n+","+n+")").on("dblclick",_),m=P.append("path").attr("fill",i(_this.arcIndex));m.on("mouseover",_this.mouseover),m.on("mouseout",_this.mouseout),m.each(y),m.transition().duration(_this.config.transitionDuration).delay(_this.config.transitionDuration*(_this.arcIndex-1)).ease(_this.config.transition).attrTween("d",_this.customArcTween);for(var I=(P.append("text").attr("x",function(){return l[0]}).attr("y",function(){return l[1]}).transition().ease(_this.config.transition).duration(_this.config.transitionDuration).delay(_this.config.transitionDuration*(_this.arcIndex-1)).attr("transform",function(t){var i=[];return i[0]=v.centroid(t)[0]-l[0],i[1]=v.centroid(t)[1]-l[1],"translate("+i+")"}).attr("text-anchor","middle").text(_this.textText).attr("title",_this.textTitle),0);I<o.length;I++)void 0!==o[I][_this.config.inner]&&_this.draw(t,i,++e,n,o[I][_this.config.inner],s,a,r+c,d+c,c,m.data()[I].startAngle,m.data()[I].endAngle,v.centroid(m.data()[I]))}},psd3.Pie.prototype.reDrawPie=function(t,i){var e=[];d3.select("#"+_this.config.containerId+"_svg").remove(),1==t.length?e=_this.zoomStack.pop():(e.push(t.data),_this.zoomStack.push(i)),_this.drawPie(e)};